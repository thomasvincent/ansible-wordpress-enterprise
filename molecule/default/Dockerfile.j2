# Molecule managed

FROM {{ item.image }}

{% if item.image.startswith('ubuntu') %}
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    python3 \
    python3-pip \
    sudo \
    bash \
    && rm -rf /var/lib/apt/lists/*

{% elif item.image.startswith('rockylinux') or item.image.startswith('centos') %}
RUN dnf -y install \
    python3 \
    python3-pip \
    sudo \
    bash \
    && dnf clean all

{% endif %}

# Install Ansible (handle PEP 668 for newer Ubuntu)
{% if item.image == 'ubuntu:24.04' %}
RUN python3 -m pip install ansible --break-system-packages
{% else %}
RUN python3 -m pip install --upgrade pip && \
    python3 -m pip install ansible
{% endif %}

WORKDIR /tmp

# Keep container running
CMD ["sleep", "infinity"]